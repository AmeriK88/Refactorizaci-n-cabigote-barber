{% extends "base.html" %}
{% load static tz widget_tweaks %}

{% block title %}Registro · Ca’Bigote{% endblock %}

{% block content %}
{% localtime on %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-7">

      <!-- CARD -->
      <div class="card card-glass shadow-sm animate-on-load" style="--a-delay: 0ms;">
        <div class="card-header gradiente-header text-center">
          <h4 class="mb-0 text-ink">
            <i class="fas fa-user-plus me-2 text-gold" aria-hidden="true"></i>
            Crear Cuenta
          </h4>
        </div>

        <!-- FORM -->
        <form method="post" class="form-dark needs-validation p-3 p-md-4 animate-on-load" style="--a-delay: 80ms;" novalidate>
          {% csrf_token %}

          {% if form.errors %}
            <div class="alert alert-danger animate-on-load" style="--a-delay: 120ms;" role="alert">
              <ul class="m-0 ps-3">
                {% for field in form %}
                  {% for error in field.errors %}
                    <li>{{ error }}</li>
                  {% endfor %}
                {% endfor %}
                {% for error in form.non_field_errors %}
                  <li>{{ error }}</li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}

          <!-- NOMBRE + APELLIDO -->
          <div class="row g-3">
            <div class="col-md-6">
              <label for="{{ form.nombre.id_for_label }}" class="form-label fw-semibold">{{ form.nombre.label }}</label>
              {% render_field form.nombre class+="form-control form-control-dark" autocomplete="given-name" %}
              {% for err in form.nombre.errors %}<div class="invalid-feedback d-block">{{ err }}</div>{% endfor %}
            </div>
            <div class="col-md-6">
              <label for="{{ form.apellido.id_for_label }}" class="form-label fw-semibold">{{ form.apellido.label }}</label>
              {% render_field form.apellido class+="form-control form-control-dark" autocomplete="family-name" %}
              {% for err in form.apellido.errors %}<div class="invalid-feedback d-block">{{ err }}</div>{% endfor %}
            </div>
          </div>

          <!-- USERNAME -->
          <div class="mt-3">
            <label for="{{ form.username.id_for_label }}" class="form-label fw-semibold">{{ form.username.label }}</label>
            {% render_field form.username class+="form-control form-control-dark" autocomplete="username" %}
            {% if form.username.help_text %}
              <small class="form-hint text-ink-muted">{{ form.username.help_text|safe }}</small>
            {% endif %}
            {% for err in form.username.errors %}<div class="invalid-feedback d-block">{{ err }}</div>{% endfor %}
          </div>

          <!-- EMAIL + TELÉFONO -->
          <div class="row g-3 mt-1">
            <div class="col-md-7">
              <label for="{{ form.email.id_for_label }}" class="form-label fw-semibold">{{ form.email.label }}</label>
              {% render_field form.email class+="form-control form-control-dark" autocomplete="email" %}
              {% for err in form.email.errors %}<div class="invalid-feedback d-block">{{ err }}</div>{% endfor %}
            </div>
            <div class="col-md-5">
              <label for="{{ form.phone.id_for_label }}" class="form-label fw-semibold">{{ form.phone.label }}</label>
              {% render_field form.phone class+="form-control form-control-dark" autocomplete="tel" %}
              {% for err in form.phone.errors %}<div class="invalid-feedback d-block">{{ err }}</div>{% endfor %}
            </div>
          </div>

          <!-- PASSWORD 1 -->
          <div class="mt-3">
            <label for="{{ form.password1.id_for_label }}" class="form-label fw-semibold">{{ form.password1.label }}</label>
            <div class="input-group">
              {% render_field form.password1 class+="form-control form-control-dark" autocomplete="new-password" %}
              <button type="button" class="btn btn-outline-gold" id="toggle-pass1" aria-label="Mostrar u ocultar contraseña">
                <i class="bi bi-eye" aria-hidden="true"></i>
              </button>
            </div>
            {% if form.password1.help_text %}
              <small class="form-hint text-ink-muted d-block mt-1">{{ form.password1.help_text|safe }}</small>
            {% endif %}
            {% for err in form.password1.errors %}<div class="invalid-feedback d-block">{{ err }}</div>{% endfor %}
          </div>

          <!-- PASSWORD 2 -->
          <div class="mt-3">
            <label for="{{ form.password2.id_for_label }}" class="form-label fw-semibold">{{ form.password2.label }}</label>
            <div class="input-group">
              {% render_field form.password2 class+="form-control form-control-dark" autocomplete="new-password" %}
              <button type="button" class="btn btn-outline-gold" id="toggle-pass2" aria-label="Mostrar u ocultar contraseña">
                <i class="bi bi-eye" aria-hidden="true"></i>
              </button>
            </div>
            {% for err in form.password2.errors %}<div class="invalid-feedback d-block">{{ err }}</div>{% endfor %}
          </div>

          <!-- CAPTCHA -->
          {% if form.captcha %}
          <div class="mt-3">
            {{ form.captcha }}
            {% for err in form.captcha.errors %}<div class="invalid-feedback d-block">{{ err }}</div>{% endfor %}
          </div>
          {% endif %}

          <!-- SUBMIT -->
          <button type="submit" class="btn btn-gold btn-lg w-100 mt-4">Registrarse</button>
        </form>
      </div>

      <!-- LINKS -->
      <div class="card card-glass border-0 text-center mt-3 p-3 shadow-sm animate-on-load" style="--a-delay: 140ms;">
        <p class="mb-2 text-ink-muted">¿Ya tienes cuenta?</p>
        <a href="{% url 'users:login' %}" class="btn btn-outline-gold btn-login w-100 w-sm-auto mx-auto">
          <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
        </a>
      </div>

    </div>
  </div>
</div>
{% endlocaltime %}
{% endblock %}

{% block extra_scripts %}
  <script src="{% static 'js/passwordToggle.js' %}" defer></script>
{% endblock %}
