{% extends "base.html" %}
{% load static tz widget_tweaks %}

{% block title %}Rese√±as ¬∑ Ca‚ÄôBigote{% endblock %}

{% block content %}
<div class="container py-5">

  <!-- ‚≠ê Cabecera -->
  <div class="card shadow-sm text-center mb-5 border-0 gradiente-header">
    <div class="card-header gradiente-header">
      <h2 class="h4 fw-bold mb-0">
        <i class="fas fa-star text-primary me-2"></i> Rese√±as
      </h2>
    </div>
  </div>

  <!-- üìú Rese√±as existentes -->
  <div class="mb-5 animate-on-load">
    {% if resenas %}
      {% for resena in resenas %}
        <div class="card mb-4 shadow-sm border-0">
          <div class="card-body">
            <p class="card-text fs-5">{{ resena.texto }}</p>
            <div class="metadata d-flex justify-content-between text-muted small">
              <span><i class="fas fa-user m-2"></i>{{ resena.usuario }}</span>
              <span><i class="fas fa-star text-warning m-2"></i>{{ resena.puntuacion }} / 5</span>
              <span><i class="fas fa-cut m-2"></i>{{ resena.servicio.nombre }}</span>
              <span><i class="fas fa-calendar-alt m-2"></i>{{ resena.fecha|date:"d/m/Y H:i" }}</span>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h5 class="text-muted">¬°Vaya! A√∫n no hay rese√±as.</h5>
          <p class="text-secondary">S√© el primero en comentar.</p>
        </div>
      </div>
    {% endif %}
  </div>

  <!-- ‚úçÔ∏è Formulario para usuarios logueados -->
  {% if user.is_authenticated %}
  <div class="row justify-content-center">
    <div class="col-md-12 col-lg-12 col-xl-12">
      <div class="card shadow-sm">
        <h4 class="card-header text-center gradiente-header">
          <i class="bi bi-star-fill text-primary me-2"></i>
          A√±adir Rese√±a
        </h4>
          <form method="post" class="needs-validation animate-on-load" novalidate>
            {% csrf_token %}

            <!-- Servicio -->
            <div class="mb-3">
              <label class="form-label" for="id_servicio">üíà Servicio</label>
              {{ form.servicio|add_class:"form-select form-select-lg" }}
              {% for error in form.servicio.errors %}
                <div class="invalid-feedback d-block">{{ error }}</div>
              {% endfor %}
            </div>

            <!-- Texto -->
            <div class="mb-3">
              <label class="form-label" for="id_texto">üìù Tu rese√±a</label>
              {{ form.texto|add_class:"form-control form-control-lg" }}
              {% for error in form.texto.errors %}
                <div class="invalid-feedback d-block">{{ error }}</div>
              {% endfor %}
            </div>

            <!-- Puntuaci√≥n -->
            <div class="mb-4">
              <label class="form-label d-block">‚≠ê Puntuaci√≥n</label>
              <div class="d-flex flex-wrap gap-2">
                {% for radio in form.puntuacion %}
                  <div class="form-check form-check-inline">
                    {{ radio.tag }}
                    <label class="form-check-label" for="{{ radio.id_for_label }}">
                      {{ radio.choice_label }}
                    </label>
                  </div>
                {% endfor %}
              </div>
              {% for error in form.puntuacion.errors %}
                <div class="invalid-feedback d-block">{{ error }}</div>
              {% endfor %}
            </div>

            <!-- Bot√≥n -->
            <button type="submit" class="btn btn-primary btn-lg w-100">
              üöÄ Enviar
            </button>
          </form>
      </div>
    </div>
  </div>
  {% else %}
    <div class="card shadow-sm">
      <div class="card-body text-center">
        <p class="mb-0 text-danger">
          <a href="{% url 'users:login' %}">Inicia sesi√≥n</a> para agregar una rese√±a.
        </p>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}
