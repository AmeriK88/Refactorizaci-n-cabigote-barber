{% extends "base.html" %}
{% load static tz widget_tweaks %}

{% block title %}Citas ¬∑ Ca‚ÄôBigote{% endblock %}

{% block content %}
{% localtime on %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-12 col-md-12 col-lg-12">
      {# üîî errores globales simplificados #}
        {% if form.errors %}
          <p class="alert alert-error">
            ¬°Aguita pap√°! Ha ocurrido un error. Por favor revisa los datos e int√©ntalo de nuevo.
          </p>
        {% endif %}

      <!-- üìã Tarjeta principal -->
      <div class="card shadow-sm">
        <div class="card-header gradiente-header text-center">
          <h4 class="mb-0">
            <i class="fas fa-calendar-check me-2 text-primary"></i> Reserva tu Cita
          </h4>
        </div>
          <form method="post" class="needs-validation animate-on-load" novalidate>
            {% csrf_token %}

            {# ------- SERVICIO ------- #}
            <div class="mb-3">
              <label class="form-label" for="id_servicio">üíà Servicio</label>
              {{ form.servicio|add_class:"form-select form-select-lg" }}
              {% for error in form.servicio.errors %}
                <div class="invalid-feedback d-block">{{ error }}</div>
              {% endfor %}
            </div>

            {# ------- PRODUCTO (opcional) ------- #}
            <div class="mb-3">
              <label class="form-label" for="id_producto">üõçÔ∏è Producto (opcional)</label>
              {{ form.producto|add_class:"form-select form-select-lg" }}
              {% for error in form.producto.errors %}
                <div class="invalid-feedback d-block">{{ error }}</div>
              {% endfor %}
            </div>

            {# ------- FECHA ------- #}
            <div class="mb-3">
              <label class="form-label" for="id_fecha">üìÜ Fecha</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
                {{ form.fecha|add_class:"form-control form-control-lg" }}
              </div>
              {% for error in form.fecha.errors %}
                <div class="invalid-feedback d-block">{{ error }}</div>
              {% endfor %}
            </div>

            {# ------- HORA ------- #}
            <div class="mb-3">
              <label class="form-label" for="id_hora">‚è∞ Hora</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-clock"></i></span>
                {{ form.hora|add_class:"form-select form-select-lg" }}
              </div>
              {% for error in form.hora.errors %}
                <div class="invalid-feedback d-block">{{ error }}</div>
              {% endfor %}
            </div>

            {# ------- COMENTARIO ------- #}
            <div class="mb-3">
              <label class="form-label" for="id_comentario">üìù Comentario</label>
              {{ form.comentario|add_class:"form-control form-control-lg" }}
              {% for error in form.comentario.errors %}
                <div class="invalid-feedback d-block">{{ error }}</div>
              {% endfor %}
            </div>

            {# ------- BOT√ìN ------- #}
            <button type="submit" class="btn btn-primary btn-lg w-100">
            ‚ú® Reservar Ahora
            </button>
          </form>
      </div>
    </div>
  </div>
</div>
{% endlocaltime %}
{% endblock %}

{% block extra_scripts %}
  <script>
    const fechasOcupadas        = {{ fechas_ocupadas|safe }};
    const fechasBloqueadas      = {{ fechas_bloqueadas|safe }};
    const horasOcupadasPorFecha = {{ horas_ocupadas_por_fecha|safe }};
    const bloqueos_por_fecha    = {{ bloqueos_por_fecha|safe }};
  </script>
  <script src="{% static 'js/disableDates.js' %}" defer></script>
{% endblock %}