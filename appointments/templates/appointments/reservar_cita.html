{% extends "base.html" %}
{% load static tz widget_tweaks %}

{% block title %}Citas ¬∑ Ca‚ÄôBigote{% endblock %}

{% block content %}
{% localtime on %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-8">

      {% if form.errors %}
        <div class="alert alert-danger mb-4 animate-on-load" style="--a-delay:0ms" role="alert">
          ¬°Aguita pap√°! Ha ocurrido un error. Revisa los campos e int√©ntalo de nuevo.
        </div>
      {% endif %}

      <!-- MAIN CARD -->
      <div class="card card-glass shadow-sm animate-on-load" style="--a-delay:80ms">
        <div class="card-header gradiente-header text-center">
          <h4 class="mb-0 text-ink">
            <i class="fas fa-calendar-check me-2 text-gold" aria-hidden="true"></i>
            Reserva tu Cita
          </h4>
        </div>

        <form method="post" class="form-dark needs-validation p-3 p-md-4" novalidate>
          {% csrf_token %}

          <!-- SERVICIO -->
          <div class="mb-3 animate-on-load" style="--a-delay:140ms">
            <label class="form-label fw-semibold" for="id_servicio">üíà Servicio</label>
            {% render_field form.servicio class+="form-select form-select-lg form-select-dark" %}
            {% for error in form.servicio.errors %}
              <div class="invalid-feedback d-block">{{ error }}</div>
            {% endfor %}
          </div>

          <!-- PRODUCTO (opcional) -->
          <div class="mb-3 animate-on-load" style="--a-delay:200ms">
            <label class="form-label fw-semibold" for="id_producto">üõçÔ∏è Producto (opcional)</label>
            {% render_field form.producto class+="form-select form-select-lg form-select-dark" %}
            {% for error in form.producto.errors %}
              <div class="invalid-feedback d-block">{{ error }}</div>
            {% endfor %}
          </div>

          <!-- FECHA + HORA -->
          <div class="row g-3">
            <div class="col-md-6 animate-on-load" style="--a-delay:260ms">
              <label class="form-label fw-semibold" for="id_fecha">üìÜ Fecha</label>
              <div class="input-group">
                <span class="input-group-text input-group-text-dark"><i class="bi bi-calendar-event"></i></span>
                {% render_field form.fecha class+="form-control form-control-lg form-control-dark" %}
              </div>
              {% for error in form.fecha.errors %}
                <div class="invalid-feedback d-block">{{ error }}</div>
              {% endfor %}
              <small class="text-ink-muted d-block mt-1">Las fechas bloqueadas no estar√°n disponibles.</small>
            </div>

            <div class="col-md-6 animate-on-load" style="--a-delay:320ms">
              <label class="form-label fw-semibold" for="id_hora">‚è∞ Hora</label>
              <div class="input-group">
                <span class="input-group-text input-group-text-dark"><i class="bi bi-clock"></i></span>
                {% render_field form.hora class+="form-select form-select-lg form-select-dark" %}
              </div>
              {% for error in form.hora.errors %}
                <div class="invalid-feedback d-block">{{ error }}</div>
              {% endfor %}
            </div>
          </div>

          <!-- COMENTARIO -->
          <div class="mb-3 mt-3 animate-on-load" style="--a-delay:380ms">
            <label class="form-label fw-semibold" for="id_comentario">üìù Comentario</label>
            {% render_field form.comentario class+="form-control form-control-lg form-control-dark" rows="3" %}
            {% for error in form.comentario.errors %}
              <div class="invalid-feedback d-block">{{ error }}</div>
            {% endfor %}
          </div>

          <button type="submit" class="btn btn-gold btn-lg w-100 mt-2 animate-on-load" style="--a-delay:440ms">
            ‚ú® Reservar Ahora
          </button>
        </form>
      </div>

    </div>
  </div>
</div>
{% endlocaltime %}
{% endblock %}

{% block extra_scripts %}
  <script>
    const fechasOcupadas        = {{ fechas_ocupadas|safe }};
    const fechasBloqueadas      = {{ fechas_bloqueadas|safe }};
    const horasOcupadasPorFecha = {{ horas_ocupadas_por_fecha|safe }};
    const bloqueos_por_fecha    = {{ bloqueos_por_fecha|safe }};
  </script>
  <script src="{% static 'js/features/appointments/disableDates.js' %}" defer></script>
{% endblock %}
